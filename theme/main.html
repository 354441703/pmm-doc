{#
  MkDocs template for PMM
  Derived from Sphinx percona theme layout.html, localtoc.html
#}
{%- set reldelim1 = reldelim1 is not defined and ' &raquo;' or reldelim1 %}
{%- set reldelim2 = reldelim2 is not defined and ' |' or reldelim2 %}
{%- set render_sidebar = (not embedded) %}
{%- set url_root =  base_url|url %}
{%- set docstitle = config.site_name %}
{# XXX necessary? #}
{%- if url_root == '#' %}{% set url_root = '' %}{% endif %}
{%- if not embedded and docstitle %}
  {%- set titlesuffix = " &mdash; "|safe + docstitle|e %}
{%- else %}
  {%- set titlesuffix = "" %}
{%- endif %}

{%- macro relbar() %}
<div class="related row">
  <ul class="nav nav-pills">
    {% if page.next_page %}
    <li class="right" style="margin-right: 10px">
      <a href="{{ page.next_page.url|url }}" title="{{ page.next_page.title }}">next</a>
    </li>
    {% endif %}
    {% if page.previous_page %}
    <li class="right" style="margin-right: 10px">
      <a href="{{ page.previous_page.url|url }}" title="{{ page.previous_page.title }}">previous</a>
    </li>
    {% endif %}
    <li>
      <a href="{{ url_root }}">home</a>
    </li>

  </ul>
</div>
{% endmacro %}

{%- macro sidebar() %}
  {%- if render_sidebar %}
  <div class="sphinxsidebar col-md-3 col-md-pull-9">
    <div class="sphinxsidebarwrapper">
      {@ product_logo @}
      {@ product_pdf_download @}

      {{ version_menu() }}
      {{ toctree() }}
      {#- include "relations.html" #}

      {@ product_series @}
    </div>
  </div>
  {%- endif %}
{%- endmacro %}

{%- macro script() %}
  <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT: '{{ config.site_url }}',
        VERSION: '{{ config.extra.release|e }}',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '{{ '' if no_search_suffix else file_suffix }}',
        HAS_SOURCE: {{ has_source| lower }}
          };
  </script>
  {%- for scriptfile in script_files %}
  <script type="text/javascript" src="{{ scriptfile }}"></script>
  {%- endfor %}
{%- endmacro %}

{%- macro css() %}
    <link rel="stylesheet" href="{{ '_static/pygments.css' }}" type="text/css" />
    {%- for cssfile in config.extra_css %}
      <link rel="stylesheet" href="{{ cssfile }}" type="text/css" />
    {%- endfor %}
{% endmacro %}

{# PMM1/PMM2 version switcher #}
{% macro version_menu() %}
<h3>
  <a href="{{ url_root }}">Table Of Contents</a>
</h3>
<style>
  .select-wrapper { display: inline-flex; flex-direction: column; }
  #custom_select { margin-bottom: 5px; }
  #custom_select_list.select-hidden { display: none; }
  #custom_select_list { display: inline-flex; flex-direction: column; padding-left: 0; }
  .custom-select__option:not(:last-child) { margin-bottom: 5x; }
</style>
<script>
window.pmm2DocRedirect = () => {
  const docLink = document.querySelector("#another-doc-version-link");
  let newLink = "https://www.percona.com/doc/percona-monitoring-and-management/2.x/index.html";
  if (docLink) {
    if (docLink.href) {
      newLink = docLink.href;
    }
  }
  window.location.href = newLink;
};
window.pmmDocRedirect = () => {
  const docLink = document.querySelector("#another-doc-version-link");
  let newLink = "https://www.percona.com/doc/percona-monitoring-and-management/index.html";
  if (docLink) {
    if (docLink.dataset.location) {
      newLink = docLink.dataset.location;
    }
  }
  window.location.href = newLink;
};
</script>
<section class="select-wrapper">
  <div class="btn btn-primary" id="custom_select">
    <span class="select-active-text"></span>
    <span class="glyphicon glyphicon-chevron-down"></span>
  </div>
  <ul class="select-hidden" id="custom_select_list">
    <li><a class="custom-select__option" href="javascript:window.pmmDocRedirect()">PMM 1</a></li>
    <li><a class="custom-select__option" href="javascript:window.pmm2DocRedirect()">PMM 2</a></li>
  </ul>
</section>
{% endmacro %}





{%- macro navi(item, class) %}
<li class="{{ class }}" style="list-style-type: disc; margin-left: 20px;">
  <a href="{{ item.url|url }}">{{ item.title }}</a>
</li>
{% endmacro %}

{% macro toctree() %}
{% if nav|length>1 %}
<ul>
  {% for nav_item in nav %}
    {% if nav_item.children %}
      <li>{{ nav_item.title }}
        <ul>
          {% for nav_item in nav_item.children %}
            {{ navi(nav_item, "toctree_l2") }}
          {% endfor %}
        </ul>
      </li>
    {% else %}
      {{ navi(nav_item, "toctree_l1") }}
    {% endif %}
  {% endfor %}
</ul>
{% endif %}
{% endmacro %}

<title>{% if page.title %}{{ page.title }} &mdash; {% endif %}{{ docstitle }}</title>
<head>
    {{ metatags }}
    {{ css() }}
    {{ script() }}
    <link rel="top" title="{{ docstitle|e }}" href="{{ base_url|url }}" />
    {% if page.next_page %}
    <link rel="next" title="{{ page.next_page.title|striptags|e }}" href="{{ page.next_page.url|e }}" />
    {% endif %}
    {% if page.previous %}
    <link rel="prev" title="{{ page.previous.title|striptags|e }}" href="{{ page.previous.url|e }}" />
    {% endif %}
  </head>
  <body>
    <div class="container">
    <div class="document row">
      <div class="documentwrapper col-md-9 col-md-push-3">
        {{ relbar() }}
        <div class="bodywrapper">
          <div class="body">
           {{ page.content }}
          </div>
        </div>
        {{ relbar() }}
      </div>
      {{ sidebar() }}
      <div class="clearer"></div>
    </div>
  </div>
</body>
